<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Question">
  <resultMap id="BaseResultMap" type="com.kingnod.etraining.exam.entity.Question">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on 2012-05-05 11:11.
    -->
    <id column="A_ID" jdbcType="DECIMAL" property="id" />
    <result column="A_FOLDER_ID" jdbcType="DECIMAL" property="folderId" />
    <result column="A_TYPE" jdbcType="CHAR" property="type" />
    <result column="A_DEGREE" jdbcType="DECIMAL" property="degree" />
    <result column="A_SCORE" jdbcType="DECIMAL" property="score" />
    <result column="A_COURSE_ID" jdbcType="VARCHAR" property="courseId" />
    <result column="A_CONTENT" jdbcType="VARCHAR" property="content" />
    <result column="A_RECORD_STATUS" jdbcType="CHAR" property="recordStatus" />
    <result column="A_UPDATE_COUNT" jdbcType="DECIMAL" property="updateCount" />
    <result column="A_CREATOR_ID" jdbcType="DECIMAL" property="creatorId" />
    <result column="A_CREATE_DATE" jdbcType="TIMESTAMP" property="createDate" />
    <result column="A_UPDATER_ID" jdbcType="DECIMAL" property="updaterId" />
    <result column="A_UPDATE_DATE" jdbcType="TIMESTAMP" property="updateDate" />
    <result column="A_KNOWLEDGE_ID" jdbcType="VARCHAR" property="knowledgeId" />
    <result column="A_PARENT_ID" jdbcType="DECIMAL" property="parentId" />
    <result column="QUESTION_KNOWLEDGE_NAME" jdbcType="VARCHAR" property="knowledgeName" />
    <result column="COURSE_INFO_COURSE_TITLE" jdbcType="VARCHAR" property="courseName" />
    <collection column="A_ID" property="childQuestionList" select="Question.findListByParentId" />
    <collection column="A_ID" property="questionKnowledges" select="QuestionKnowledge.findListById" />
    <collection column="A_ID" property="questionAnswers" select="QuestionAnswer.findListByQuestionAnswer" />
    <collection column="A_ID" property="courseList" select="Question.findCourseListById" />
    <collection column="A_ID" property="knowledgeList" select="Question.findKnowledgeListById" />
  </resultMap>
  <resultMap id="AutoQuestionResultMap" type="com.kingnod.etraining.exam.entity.Question">
    <!--WARNING - @自定义 -->
    <id column="A_ID" jdbcType="DECIMAL" property="id" />
    <result column="A_FOLDER_ID" jdbcType="DECIMAL" property="folderId" />
    <result column="A_TYPE" jdbcType="CHAR" property="type" />
    <result column="A_DEGREE" jdbcType="DECIMAL" property="degree" />
    <result column="A_SCORE" jdbcType="DECIMAL" property="score" />
    <result column="A_COURSE_ID" jdbcType="VARCHAR" property="courseId" />
    <result column="A_CONTENT" jdbcType="VARCHAR" property="content" />
    <result column="A_RECORD_STATUS" jdbcType="CHAR" property="recordStatus" />
    <result column="A_UPDATE_COUNT" jdbcType="DECIMAL" property="updateCount" />
    <result column="A_CREATOR_ID" jdbcType="DECIMAL" property="creatorId" />
    <result column="A_CREATE_DATE" jdbcType="TIMESTAMP" property="createDate" />
    <result column="A_UPDATER_ID" jdbcType="DECIMAL" property="updaterId" />
    <result column="A_UPDATE_DATE" jdbcType="TIMESTAMP" property="updateDate" />
    <result column="A_KNOWLEDGE_ID" jdbcType="VARCHAR" property="knowledgeId" />
    <result column="A_PARENT_ID" jdbcType="DECIMAL" property="parentId" />
    <collection column="A_ID" property="childQuestionList" select="Question.findListByParentId" />
    <collection column="A_ID" property="questionAnswers" select="QuestionAnswer.findListByQuestionAnswer" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on 2012-05-05 11:11.
    -->
    A.ID as A_ID, A.FOLDER_ID as A_FOLDER_ID, A.TYPE as A_TYPE, A.DEGREE as A_DEGREE, 
    A.SCORE as A_SCORE, A.COURSE_ID as A_COURSE_ID, A.CONTENT as A_CONTENT, A.RECORD_STATUS as A_RECORD_STATUS, 
    A.UPDATE_COUNT as A_UPDATE_COUNT, A.CREATOR_ID as A_CREATOR_ID, A.CREATE_DATE as A_CREATE_DATE, 
    A.UPDATER_ID as A_UPDATER_ID, A.UPDATE_DATE as A_UPDATE_DATE, A.KNOWLEDGE_ID as A_KNOWLEDGE_ID, 
    A.PARENT_ID as A_PARENT_ID
  </sql>
  
  <select id="findById" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on 2012-05-05 11:11.
    -->
    select 
    <include refid="Base_Column_List" />
    from EXM_QUESTION A
    where A.ID = #{id,jdbcType=DECIMAL}
  </select>
  <delete id="deleteById" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on 2012-05-05 11:11.
    -->
    delete from EXM_QUESTION
    where ID = #{id,jdbcType=DECIMAL}
  </delete>
  <delete id="deleteByCriteria" parameterType="com.kingnod.core.criteria.Criteria">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on 2012-05-05 11:11.
    -->
    delete from EXM_QUESTION A
    <if test="_parameter != null">
      <where>
        <include refid="Global.Where_Clause" />
      </where>
    </if>
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on 2012-05-05 11:11.
    -->
  </delete>
  <insert id="insert" parameterType="com.kingnod.etraining.exam.entity.Question">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on 2012-05-05 11:11.
    -->
    <selectKey keyProperty="id" order="BEFORE" resultType="java.lang.Long">
      select EXM_QUESTION_SEQ.nextval from dual
    </selectKey>
    insert into EXM_QUESTION (ID, FOLDER_ID, TYPE, 
      DEGREE, SCORE, COURSE_ID, 
      CONTENT, RECORD_STATUS, UPDATE_COUNT, 
      CREATOR_ID, CREATE_DATE, UPDATER_ID, 
      UPDATE_DATE, KNOWLEDGE_ID, PARENT_ID
      )
    values (#{id,jdbcType=DECIMAL}, #{folderId,jdbcType=DECIMAL}, #{type,jdbcType=CHAR}, 
      #{degree,jdbcType=DECIMAL}, #{score,jdbcType=DECIMAL}, #{courseId,jdbcType=VARCHAR}, 
      #{content,jdbcType=VARCHAR}, #{recordStatus,jdbcType=CHAR}, #{updateCount,jdbcType=DECIMAL}, 
      #{creatorId,jdbcType=DECIMAL}, #{createDate,jdbcType=TIMESTAMP}, #{updaterId,jdbcType=DECIMAL}, 
      #{updateDate,jdbcType=TIMESTAMP}, #{knowledgeId,jdbcType=VARCHAR}, #{parentId,jdbcType=DECIMAL}
      )
  </insert>
  
  <update id="updateByCriteria" parameterType="map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on 2012-05-05 11:11.
    -->
    update EXM_QUESTION A
    <set>
      <if test="record.id != null">
        A.ID = #{record.id,jdbcType=DECIMAL},
      </if>
      <if test="record.folderId != null">
        A.FOLDER_ID = #{record.folderId,jdbcType=DECIMAL},
      </if>
      <if test="record.type != null">
        A.TYPE = #{record.type,jdbcType=CHAR},
      </if>
      <if test="record.degree != null">
        A.DEGREE = #{record.degree,jdbcType=DECIMAL},
      </if>
      <if test="record.score != null">
        A.SCORE = #{record.score,jdbcType=DECIMAL},
      </if>
      <if test="record.courseId != null">
        A.COURSE_ID = #{record.courseId,jdbcType=VARCHAR},
      </if>
      <if test="record.content != null">
        A.CONTENT = #{record.content,jdbcType=VARCHAR},
      </if>
      <if test="record.recordStatus != null">
        A.RECORD_STATUS = #{record.recordStatus,jdbcType=CHAR},
      </if>
      <if test="record.updateCount != null">
        A.UPDATE_COUNT = #{record.updateCount,jdbcType=DECIMAL},
      </if>
      <if test="record.creatorId != null">
        A.CREATOR_ID = #{record.creatorId,jdbcType=DECIMAL},
      </if>
      <if test="record.createDate != null">
        A.CREATE_DATE = #{record.createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="record.updaterId != null">
        A.UPDATER_ID = #{record.updaterId,jdbcType=DECIMAL},
      </if>
      <if test="record.updateDate != null">
        A.UPDATE_DATE = #{record.updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="record.knowledgeId != null">
        A.KNOWLEDGE_ID = #{record.knowledgeId,jdbcType=VARCHAR},
      </if>
      <if test="record.parentId != null">
        A.PARENT_ID = #{record.parentId,jdbcType=DECIMAL},
      </if>
    </set>
    <if test="_parameter != null">
      <where>
        <include refid="Global.Where_Clause" />
      </where>
    </if>
  </update>
  <update id="update" parameterType="com.kingnod.etraining.exam.entity.Question">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on 2012-05-05 11:11.
    -->
    update EXM_QUESTION A
    <set>
      <if test="id != null">
        A.ID = #{id,jdbcType=DECIMAL},
      </if>
      <if test="folderId != null">
        A.FOLDER_ID = #{folderId,jdbcType=DECIMAL},
      </if>
      <if test="type != null">
        A.TYPE = #{type,jdbcType=CHAR},
      </if>
      <if test="degree != null">
        A.DEGREE = #{degree,jdbcType=DECIMAL},
      </if>
      <if test="score != null">
        A.SCORE = #{score,jdbcType=DECIMAL},
      </if>
      <if test="courseId != null">
        A.COURSE_ID = #{courseId,jdbcType=VARCHAR},
      </if>
      <if test="content != null">
        A.CONTENT = #{content,jdbcType=VARCHAR},
      </if>
      <if test="recordStatus != null">
        A.RECORD_STATUS = #{recordStatus,jdbcType=CHAR},
      </if>
      <if test="updateCount != null">
        A.UPDATE_COUNT = #{updateCount,jdbcType=DECIMAL},
      </if>
      <if test="creatorId != null">
        A.CREATOR_ID = #{creatorId,jdbcType=DECIMAL},
      </if>
      <if test="createDate != null">
        A.CREATE_DATE = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updaterId != null">
        A.UPDATER_ID = #{updaterId,jdbcType=DECIMAL},
      </if>
      <if test="updateDate != null">
        A.UPDATE_DATE = #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="knowledgeId != null">
        A.KNOWLEDGE_ID = #{knowledgeId,jdbcType=VARCHAR},
      </if>
      <if test="parentId != null">
        A.PARENT_ID = #{parentId,jdbcType=DECIMAL},
      </if>
    </set>
    where A.ID = #{id,jdbcType=DECIMAL}
  </update>
  <select id="findByCriteria" parameterType="com.kingnod.core.criteria.Criteria" resultMap="BaseResultMap">
    <!--
      WARNING - @自定义
    -->
    select distinct
    <include refid="Base_Column_List" />
     from EXM_QUESTION A LEFT JOIN CRS_COURSE_INFO C ON A.COURSE_ID LIKE '%'||C.ID||'%' LEFT JOIN  EXM_KNOWLEDGE B  ON A.KNOWLEDGE_ID LIKE '%'||B.ID||'%'
      <if test="params.folderId != null">
       inner join RES_FOLDER_HIERARCHY M on A.FOLDER_ID = M.FOLDER_ID and M.HIERARCHY_ID = #{params.folderId,jdbcType=DECIMAL} and M.RECORD_STATUS = 'A'
     </if>
    <if test="_parameter != null">
      <where><include refid="Global.Where_Clause" /></where>
    </if>
    <if test="hasOrderBy">
      order by
      <foreach collection="orderBys" item="orderBy" separator=",">
        ${orderBy}
      </foreach>
    </if>
  </select>
  <select id="countByCriteria" parameterType="com.kingnod.core.criteria.Criteria" resultType="java.lang.Integer">
    <!--
      WARNING - @自定义
    -->
	select count(distinct A.ID)
     from EXM_QUESTION A LEFT JOIN CRS_COURSE_INFO C ON A.COURSE_ID LIKE '%'||C.ID||'%' LEFT JOIN  EXM_KNOWLEDGE B  ON A.KNOWLEDGE_ID LIKE '%'||B.ID||'%'
      <if test="params.folderId != null">
       inner join RES_FOLDER_HIERARCHY M on A.FOLDER_ID = M.FOLDER_ID and M.HIERARCHY_ID = #{params.folderId,jdbcType=DECIMAL} and M.RECORD_STATUS = 'A'
     </if>
    <if test="_parameter != null">
      <where><include refid="Global.Where_Clause" /></where>
    </if>
  </select>
  
  <!-- 自定义sql -->
  <select id="getQuestionId" resultType="java.lang.Integer">
  	select id from EXM_QUESTION where rownum = 1 AND RECORD_STATUS = 'A' order by id desc
  </select>
  
  <select id="selectAllQuestion" resultMap="BaseResultMap">
  	select * from EXM_QUESTION WHERE RECORD_STATUS = 'A' order by id desc
  </select>
  
  <select id="findListByQuestion" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!-- WARNING - @自定义  -->
    select 
    <include refid="Base_Column_List" />
    from EXM_QUESTION A
    where A.ID = #{id,jdbcType=DECIMAL} AND A.RECORD_STATUS = 'A'
  </select>
  
  <select id="findListByExamineeQuestion" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @自定义
    -->
    select
    <include refid="Base_Column_List" />
     from EXM_EXAMINESS_QUESTION A LEFT JOIN EXM_EXAM_PAPER B ON A.EXM_QUESTION A
     <where>
      <if test="courseId != null">
        and A.QUESTION_ID = #{id,jdbcType=DECIMAL}
      </if>
      AND A.RECORD_STATUS = 'A'
     </where>
  </select>
  
  <select id="findByQuestionList" parameterType="com.kingnod.etraining.exam.entity.Question" resultMap="BaseResultMap">
    <!-- WARNING - @自定义  -->
    select
    <include refid="Base_Column_List" />
     from EXM_QUESTION A
     <where>
      <if test="type != null">
        A.TYPE = #{type,jdbcType=CHAR}
      </if>
      <if test="folderId != null">
        and A.FOLDER_ID = #{folderId,jdbcType=DECIMAL}
      </if>
      <if test="degree != null">
        and A.DEGREE = #{degree,jdbcType=DECIMAL}
      </if>
      <if test="knowledge != null">
        and A.KNOWLEDGE = #{knowledge,jdbcType=DECIMAL}
      </if>
      <if test="courseId != null">
        and A.COURSE_ID = #{courseId,jdbcType=DECIMAL}
      </if>
      AND A.RECORD_STATUS = 'A'
     </where>
  </select>
  
  
  <select id="findCriteriaByQuestion" parameterType="com.kingnod.core.criteria.Criteria" resultMap="BaseResultMap">
  	<!-- WARNING - @自定义  查询预览的试题 -->
  	SELECT B.ID        A_ID,
	       B.TYPE      A_TYPE,
	       A.DEGREE    A_DEGREE,
	       A.SCORE     A_SCORE,
	       B.KNOWLEDGE_ID A_KNOWLEDGE_ID,
	       B.COURSE_ID A_COURSE_ID,
	       B.CONTENT   A_CONTENT
	  FROM EXM_QUESTION_TEST_GROUP A, EXM_QUESTION B
        <if test="_parameter != null">
	      <where><include refid="Global.Where_Clause" /></where>
	    </if>
	    AND A.QUESTION_ID = B.ID
	    AND A.RECORD_STATUS = 'A'
	    AND B.RECORD_STATUS = 'A'
  </select>
  
  <select id="countBySearchQuestion" parameterType="com.kingnod.core.criteria.Criteria" resultType="java.lang.Integer">
    <!-- @查询搜索结果的数据条数  -->
    SELECT COUNT(distinct A.ID)
	  FROM EXM_QUESTION A 
	  <if test="@com.kingnod.core.util.StringUtils@isNotEmpty(params.knowledgeId)">
  		INNER JOIN EXM_QUESTION_KNOWLEDGE C ON A.ID = C.QUESTION_ID AND C.TYPE = 'K' AND C.RECORD_STATUS = 'A'
	  </if>
	  <if test="@com.kingnod.core.util.StringUtils@isNotEmpty(params.courseId)">
	  	INNER JOIN EXM_QUESTION_KNOWLEDGE B on A.ID = B.QUESTION_ID AND B.TYPE = 'C' AND B.RECORD_STATUS = 'A'
	  </if>
  	<if test="_parameter != null">
      <where><include refid="Global.Where_Clause" /></where>
    </if>
  </select>
	
  <select id="findListBySearchQuestion" parameterType="com.kingnod.core.criteria.Criteria" resultMap="BaseResultMap">
  	<!-- @自定义  根据条件 查询试题 -->
  	SELECT DISTINCT 
	<include refid="Base_Column_List" />
	  FROM EXM_QUESTION A 
	  <if test="@com.kingnod.core.util.StringUtils@isNotEmpty(params.knowledgeId)">
  		INNER JOIN EXM_QUESTION_KNOWLEDGE C ON A.ID = C.QUESTION_ID AND C.TYPE = 'K' AND C.RECORD_STATUS = 'A'
	  </if>
	  <if test="@com.kingnod.core.util.StringUtils@isNotEmpty(params.courseId)">
	  	INNER JOIN EXM_QUESTION_KNOWLEDGE B on A.ID = B.QUESTION_ID AND B.TYPE = 'C' AND B.RECORD_STATUS = 'A'
	  </if>
  	<if test="_parameter != null">
      <where><include refid="Global.Where_Clause" /></where>
    </if>
    <if test="hasOrderBy">
      order by
      <foreach collection="orderBys" item="orderBy" separator=",">
        ${orderBy}
      </foreach>
    </if>
  </select>
  
  <select id="searchByQuestion" parameterType="com.kingnod.etraining.exam.entity.Question" resultMap="BaseResultMap">
  	<!-- WARNING - @自定义  根据条件查询试题  -->
	SELECT
	<include refid="Base_Column_List" />
	  FROM EXM_QUESTION A 
	  <if test="@com.kingnod.core.util.StringUtils@isNotEmpty(knowledgeId)">
	  	  LEFT JOIN EXM_QUESTION_KNOWLEDGE C ON A.ID = C.QUESTION_ID	  
	  </if>
	 WHERE 
	  <if test="type != null">
        A.TYPE = #{type,jdbcType=CHAR}  
      </if>
      <if test="@com.kingnod.core.util.ArrayUtils@isNotEmpty(questionDegree)">
       AND A.DEGREE in
      <foreach close=")" collection="questionDegree" item="criterion" open="(" separator=",">
      	  #{criterion}
      </foreach>
      </if>
      <if test="questionFolderId != null">
      	<if test="questionFolderId != ''">
      		AND A.FOLDER_ID = #{questionFolderId,jdbcType=DECIMAL}
      	</if>
      </if>
      <if test="courseId != null">
      	<if test="courseId != ''">
      		AND A.COURSE_ID = #{courseId,jdbcType=DECIMAL}
      	</if>
      </if>
      <if test="knowledgeId != null">
      	<if test="knowledgeId != ''">
      		AND C.KNOWLEDGE_ID = #{knowledgeId,jdbcType=DECIMAL}
      		AND C.RECORD_STATUS = 'A'
      	</if>
      </if>
       AND A.RECORD_STATUS = 'A'
	   AND A.ID NOT IN (SELECT B.QUESTION_ID
	                      FROM EXM_QUESTION_TEST_GROUP B
	                     WHERE (
	                     <if test="examPaperId != null">
					        B.EXAM_PAPER_ID = #{examPaperId,jdbcType=DECIMAL}
					     </if>
					     <if test="testGroupId != null">
					        AND B.TEST_GROUP_ID = #{testGroupId,jdbcType=DECIMAL}
					     </if>
					     <if test="type != null">
					        AND B.TYPE = #{type,jdbcType=CHAR}
					     </if>
					     AND B.RECORD_STATUS = 'A'
	                     ))
  </select>
  
  <select id="findListByParentId" parameterType="java.lang.Long" resultMap="BaseResultMap">
  	<!--  @自定义   查询组合题中的子题目  -->
  	SELECT 
  	<include refid="Base_Column_List" />
	FROM EXM_QUESTION A WHERE A.PARENT_ID = #{parentId,jdbcType=DECIMAL} AND A.RECORD_STATUS = 'A'
  </select>
   
  
  <select id="findByCriteriaKnowledgeQuestion" parameterType="com.kingnod.core.criteria.Criteria" resultMap="BaseResultMap">
    <!--
      WARNING - @自定义查询知识点
    -->
    select distinct 
    <include refid="Base_Column_List" />
     from EXM_QUESTION A ,EXM_QUESTION_KNOWLEDGE B
         WHERE   B.RECORD_STATUS = 'A'   AND 
         A.RECORD_STATUS = 'A'  AND 
         A.ID = B.QUESTION_ID AND B.KNOWLEDGE_ID =#{params.knowledgeId,jdbcType=DECIMAL}
    <if test="hasOrderBy">
      order by
      <foreach collection="orderBys" item="orderBy" separator=",">
        ${orderBy}
      </foreach>
    </if>
  </select>
  <select id="countByCriteriaKnowledgeQuestion" parameterType="com.kingnod.core.criteria.Criteria" resultType="java.lang.Integer">
    <!--
      WARNING - @自定义
    -->
    select count(DISTINCT(A.ID)) from EXM_QUESTION A ,EXM_QUESTION_KNOWLEDGE B 
       WHERE   B.RECORD_STATUS = 'A'   AND 
         A.RECORD_STATUS = 'A'  AND 
         A.ID = B.QUESTION_ID AND B.KNOWLEDGE_ID =#{params.knowledgeId,jdbcType=DECIMAL}
   
  </select>
  
  <select id="findListByConditionRule" parameterType="com.kingnod.etraining.exam.entity.ConditionRule" resultMap="BaseResultMap">
  <!-- @自定义   根据规则  查询试题 -->
	SELECT
	  <include refid="Base_Column_List" />
	  FROM (SELECT B.*, ROWNUM ROWNUMBER
          	  FROM EXM_QUESTION B
         	 WHERE B.RECORD_STATUS = 'A'
         	 <if test="@com.kingnod.core.util.StringUtils@isNotEmpty(conditionType)">
         	 	<if test="conditionType != 'U '.trim()">
         	 		AND B.TYPE = #{conditionType,jdbcType=CHAR}
         	 	</if>
         	 </if>
         	 <if test="null != folderIdArray">
		 		AND B.FOLDER_ID IN 
		 		<foreach close=")" collection="folderIdArray" item="criterion" open="(" separator=",">
		      	  #{criterion}
		        </foreach>
		 	</if>
 			<if test="null == examNumber">
 				<if test="@com.kingnod.core.util.collection.ListUtils@isNotEmpty(idsList)">
 					AND B.ID NOT IN
	 				<foreach close=")" collection="idsList" item="criterion" open="(" separator=",">
			      	  #{criterion}
			        </foreach>
 				</if>
 			</if>
	 		<if test="null != examinationId">
	 			<if test="null != examNumber">
	 			 AND B.ID NOT IN
	 			 (
			 		SELECT C.QUESTION_ID
	                  FROM EXM_EXAMINEE_QUESTION C
	                 WHERE C.EXAM_PAPER_ID = #{examPaperId,jdbcType=DECIMAL}
	                   AND C.USER_ID = #{userId,jdbcType=DECIMAL}
	                   AND C.EXAMINATION_ID = #{examinationId,jdbcType=DECIMAL}
	                   AND C.EXAM_NUMBER = #{examNumber,jdbcType=DECIMAL}
	                   AND C.RECORD_STATUS = 'A'
	             )
	 			</if>
	 		</if>
	 		<if test="null != courseIdArray">
			AND B.ID IN (SELECT C.QUESTION_ID FROM EXM_QUESTION_KNOWLEDGE C
		                  WHERE C.RECORD_STATUS = 'A' 
		                    AND C.KNOWLEDGE_ID IN 
		                  <foreach close=")" collection="courseIdArray" item="criterion" open="(" separator=",">
					      	#{criterion}
					      </foreach>
					      AND C.TYPE = 'C'
		                 )
		   </if>
		   <if test="null != knowledgeIdArray">
			   AND B.ID IN (SELECT D.QUESTION_ID FROM EXM_QUESTION_KNOWLEDGE D
		                     WHERE D.RECORD_STATUS = 'A' 
		                       AND D.KNOWLEDGE_ID IN 
		                     <foreach close=")" collection="knowledgeIdArray" item="criterion" open="(" separator=",">
					     	 	#{criterion}
						     </foreach>
		                       AND D.TYPE = 'K'
		                   )
		   </if>
	 	   ) A
	 WHERE 
	 	<if test="null != rowNumerdList">
	 		<if test="'' != rowNumerdList">
		 		A.ROWNUMBER IN 
		 		<foreach close=")" collection="rowNumerdList" item="criterion" open="(" separator=",">
		      	  #{criterion}
		        </foreach>
		        AND A.RECORD_STATUS = 'A'
	 		</if>
	 	</if>
	 	<!-- 
	    <if test="null != courseIdArray">
	    	<if test="'' != courseIdArray">
		    	AND A.COURSE_ID IN 
		 		<foreach close=")" collection="courseIdArray" item="criterion" open="(" separator=",">
		      	  #{criterion}
		        </foreach>
	    	</if>
	 	</if>
	    <if test="null != knowledgeIdArray">
	    	<if test="'' != knowledgeIdArray">
		    	AND A.KNOWLEDGE_ID IN 
		 		<foreach close=")" collection="knowledgeIdArray" item="criterion" open="(" separator=",">
		      	  #{criterion}
		        </foreach>
	    	</if>
	 	</if>
	 	 -->
  </select>
  
  
  <sql id="MyBase_Column_List">
    <!--
      WARNING - @自定义
    -->
    A.ID as A_ID, A.FOLDER_ID as A_FOLDER_ID, A.TYPE as A_TYPE, A.DEGREE as A_DEGREE, 
    A.COURSE_ID as A_COURSE_ID, A.CONTENT as A_CONTENT, A.RECORD_STATUS as A_RECORD_STATUS, 
    A.UPDATE_COUNT as A_UPDATE_COUNT, A.CREATOR_ID as A_CREATOR_ID, A.CREATE_DATE as A_CREATE_DATE, 
    A.UPDATER_ID as A_UPDATER_ID, A.UPDATE_DATE as A_UPDATE_DATE, A.KNOWLEDGE_ID as A_KNOWLEDGE_ID, 
    A.PARENT_ID as A_PARENT_ID
  </sql>
  
  <select id="findListByConditionRulePreview" parameterType="com.kingnod.etraining.exam.entity.ConditionRule" resultMap="BaseResultMap">
  <!-- @自定义   根据规则  查询试题  为预览试卷做准备 -->
	SELECT
	  <include refid="Base_Column_List" />
	  FROM (SELECT B.*, ROWNUM ROWNUMBER
          	  FROM EXM_QUESTION B
         	 WHERE B.RECORD_STATUS = 'A'
         	 <if test="@com.kingnod.core.util.StringUtils@isNotEmpty(conditionType)">
         	  AND B.TYPE = #{conditionType,jdbcType=CHAR}
         	 </if>
         	 <if test="null != folderIdArray">
		 		AND B.FOLDER_ID IN 
		 		<foreach close=")" collection="folderIdArray" item="criterion" open="(" separator=",">
		      	  #{criterion}
		        </foreach>
		 	</if>
		 	) A
	 WHERE 
	 	<if test="null != rowNumerdList">
	 		<if test="'' != rowNumerdList">
		 		A.ROWNUMBER IN 
		 		<foreach close=")" collection="rowNumerdList" item="criterion" open="(" separator=",">
		      	  #{criterion}
		        </foreach>
		        AND A.RECORD_STATUS = 'A'
	 		</if>
	 	</if>
	    <if test="null != courseIdArray">
	    	<if test="'' != courseIdArray">
		    	AND A.COURSE_ID IN 
		 		<foreach close=")" collection="courseIdArray" item="criterion" open="(" separator=",">
		      	  #{criterion}
		        </foreach>
	    	</if>
	 	</if>
	    <if test="null != knowledgeIdArray">
	    	<if test="'' != knowledgeIdArray">
		    	AND A.KNOWLEDGE_ID IN 
		 		<foreach close=")" collection="knowledgeIdArray" item="criterion" open="(" separator=",">
		      	  #{criterion}
		        </foreach>
	    	</if>
	 	</if>
  </select>
  
  <select id="findAllByAutoGeneratingQuestion" parameterType="com.kingnod.etraining.exam.entity.ExamineeQuestion" resultMap="AutoQuestionResultMap">
	SELECT 
		A.ID            as A_ID,
		A.FOLDER_ID     as A_FOLDER_ID,
		A.TYPE          as A_TYPE,
		B.DEGREE        as A_DEGREE,
		B.SCORE         as A_SCORE,
		A.COURSE_ID     as A_COURSE_ID,
		A.CONTENT       as A_CONTENT,
		A.RECORD_STATUS as A_RECORD_STATUS,
		A.KNOWLEDGE_ID  as A_KNOWLEDGE_ID,
		A.PARENT_ID     as A_PARENT_ID
	  FROM EXM_QUESTION A, EXM_EXAMINEE_QUESTION B
	 WHERE A.ID = B.QUESTION_ID
	   AND B.EXAM_PAPER_ID = #{examPaperId,jdbcType=DECIMAL}
	   AND B.EXAM_NUMBER = #{examNumber,jdbcType=DECIMAL}
	   AND B.EXAMINATION_ID = #{examinationId,jdbcType=DECIMAL}
	   AND B.USER_ID = #{userId,jdbcType=DECIMAL}
  </select>

  <select id="findCourseListById" parameterType="java.lang.Long" resultMap="QuestionKnowledge.BaseResultMap">
	SELECT 
	  <include refid="QuestionKnowledge.Base_Column_List"/>
	  FROM EXM_QUESTION_KNOWLEDGE A
	 WHERE A.RECORD_STATUS = 'A'
	   AND A.TYPE = 'C'
	   AND A.QUESTION_ID = #{id,jdbcType=DECIMAL}
  </select>
  <select id="findKnowledgeListById" parameterType="java.lang.Long" resultMap="QuestionKnowledge.BaseResultMap">
	SELECT
	  <include refid="QuestionKnowledge.Base_Column_List"/>
	  FROM EXM_QUESTION_KNOWLEDGE A
	 WHERE A.RECORD_STATUS = 'A'
	   AND A.TYPE = 'K'
	   AND A.QUESTION_ID = #{id,jdbcType=DECIMAL}
  </select>
  
  <select id="previewQuestionTestGroup" parameterType="com.kingnod.core.criteria.Criteria" resultMap="BaseResultMap">
	<!-- @自定义  查询当前题纲下面所有满足条件的试题  -->
	SELECT A.ID            as A_ID,
	       A.FOLDER_ID     as A_FOLDER_ID,
	       A.TYPE          as A_TYPE,
	       A.DEGREE        as A_DEGREE,
	       B.SCORE         as A_SCORE,
	       A.COURSE_ID     as A_COURSE_ID,
	       A.CONTENT       as A_CONTENT,
	       A.RECORD_STATUS as A_RECORD_STATUS,
	       A.UPDATE_COUNT  as A_UPDATE_COUNT,
	       A.CREATOR_ID    as A_CREATOR_ID,
	       A.CREATE_DATE   as A_CREATE_DATE,
	       A.UPDATER_ID    as A_UPDATER_ID,
	       A.UPDATE_DATE   as A_UPDATE_DATE,
	       A.KNOWLEDGE_ID  as A_KNOWLEDGE_ID,
	       A.PARENT_ID     as A_PARENT_ID
	  FROM EXM_QUESTION A, EXM_QUESTION_TEST_GROUP B
     <if test="_parameter != null">
     	<where><include refid="Global.Where_Clause" /></where>
     </if>
     AND A.ID = B.QUESTION_ID
     <if test="hasOrderBy">
       order by
       <foreach collection="orderBys" item="orderBy" separator=",">
         ${orderBy}
       </foreach>
     </if>
  </select>
  
</mapper>